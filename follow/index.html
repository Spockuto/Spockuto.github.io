<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body onload="queryString()">
<!--Needs OAuth token of a user-->
  <button id="button" onclick="Redirect()">Follow</button>
  <script type="text/javascript">
    
    function queryString(){

          var code = getParameterByName("code");
          if(code){
            accessToken(code);}

          var access = getParameterByName("access_token");
          if(access){
            Follow(access);
            }
          }
    
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    function Redirect(){
      window.open("https://github.com/login/oauth/authorize?client_id=e644584e5ceb8a2eb2c1&scope=user:follow&redirect_uri=http://www.venkkateshsekar.me/follow");
    }

    function accessToken(code){

      var data = new FormData();
      data.append('client_id', 'e644584e5ceb8a2eb2c1');
      data.append('client_secret', '9509bfb80f2faf2453553f4d8048519ddb263039');
      data.append('code', code);
      data.append('redirect_uri','http://www.venkkateshsekar.me/follow/');

      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'https://github.com/login/oauth/access_token', true);
      xmlHttp.setRequestHeader('Access-Control-Allow-Origin', "*"); 
      xhr.send(data);
    }

    function Follow(access_token){

n        var OauthToken = null;
        var xmlHttp = new XMLHttpRequest(); 
            var mimeType = "text/plain";  
          
            xmlHttp.open('PUT', 'https://api.github.com/user/following/lepture', true);  
            xmlHttp.setRequestHeader('Content-Type', mimeType);  
          xmlHttp.setRequestHeader('Authorization','token '+ access_token);
          xmlHttp.send(null);
          var statusCode = xmlHttp.status ;

          document.getElementById("shit").innerHTML = xmlHttp.responseText;
          if (statusCode == 0)  {
            document.getElementById("button").innerHTML = "Unfollow" ;
          }
          
          else {
            window.open("https://www.github.com/lepture");
          }
        }

        else{
          var xmlHttp = new XMLHttpRequest(); 
            var mimeType = "text/plain";  
            xmlHttp.open('DELETE', 'https://api.github.com/user/following/lepture', true);  
            xmlHttp.setRequestHeader('Content-Type', mimeType);  
            xmlHttp.setRequestHeader('Authorization','token '+ access_token);
          xmlHttp.send(null);
          var statusCode = xmlHttp.status ;
          document.getElementById("shit").innerHTML = xmlHttp.responseText;
          if (statusCode == 0)  {
            document.getElementById("button").innerHTML = "Follow" ;
          }
          else {
            window.open("https://www.github.com/lepture");
          }
        }
    } 

  </script>
</body>
</html>